{"version":3,"file":"tiny-vue.esm.js","sources":["../src/compiler-core/src/parser.ts"],"sourcesContent":["import { NodeTypes } from \"./ast\";\n\nexport function baseParse(content: string) {\n    const context = createParserContext(content);\n    return createRoot(parseChildren(context));\n}\n\nfunction createParserContext(content) {\n    console.log(\"创建 paserContext\");\n    return {\n        source: content,\n    };\n}\n\nfunction parseChildren(context) {\n    console.log(\"开始解析 children\");\n    const nodes: any[] = [];\n\n    let node = {};\n    // {{ 开头\n    if (context.source.startsWith(\"{{\")) {\n        node = parseMustache(context);\n    } else {\n        node = parseText(context);\n    }\n    nodes.push(node);\n\n    return nodes;\n}\n\nfunction parseText(context): any {\n    console.log(\"解析 text\", context);\n    const endIndex = context.source.length;\n    const content = parseTextData(context, endIndex);\n\n    return {\n        type: NodeTypes.TEXT,\n        content,\n    };\n}\n\nfunction parseTextData(context: any, length: number): any {\n    console.log(\"解析 textData\");\n    //\n    const rawText = context.source.slice(0, length);\n    // 移动光标\n    advanceBy(context, length);\n\n    return rawText;\n}\n\nfunction parseMustache(context) {\n    console.log(\"解析 mustache\", context);\n    let content = context.source;\n\n    // 查找结束标识\n    const startIndex = context.source.indexOf(\"{{\");\n    const endIndex = context.source.indexOf(\"}}\");\n\n\n    // 没有 {{ 或者 }}\n    if (startIndex == -1 || endIndex == -1) {\n        console.warn(`${context.source} is not a valid interpolation`);\n    } else {\n        // 移除 {{\n        advanceBy(context, 2)\n        content = parseSimpleExpress(startIndex, context.source.length - 2, context);\n        // 移除 }}\n        advanceBy(context, 2)\n    }\n    return {\n        type: NodeTypes.INTERPOLATION,\n        content,\n    };\n}\n\nfunction parseSimpleExpress(startIndex, endIndex, context) {\n    console.log(\"解析 simple express\");\n\n    const rawText = context.source.slice(startIndex, endIndex);\n\n    // 移除 值\n    advanceBy(context, endIndex);\n\n    return {\n        type: NodeTypes.SIMPLE_EXPRESSION,\n        content: rawText.trim(),\n    };\n}\n\nfunction advanceBy(context, numberOfCharacters) {\n    console.log(\"移动光标\", context, numberOfCharacters);\n    context.source = context.source.slice(numberOfCharacters);\n}\n\nfunction createRoot(children) {\n    return {\n        type: NodeTypes.ROOT,\n        children,\n    };\n}\n"],"names":[],"mappings":"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"}
{"version":3,"file":"tiny-vue.esm.js","sources":["../src/runtime-core/createVNode.ts","../src/runtime-core/h.ts","../src/runtime-core/component.ts","../src/runtime-core/render-api/index.ts","../src/runtime-core/renderer.ts","../src/runtime-core/createApp.ts"],"sourcesContent":["import { ShapeFlags } from '../shared'\n\n/**\n * @description: 创建虚拟节点\n * @param {any} type 节点类型\n * @param {any} props 节点上的属性\n * @param {any} children 子节点\n * @return {VNode}\n */\nexport const createVNode = function (\n    type: any,\n    props: any,\n    children: string | Array<any>\n): any {\n\n    const vnode = {\n        el: null,\n        component: null,\n        type,\n        props,\n        children,\n        shapeFlag: getShapeFlag(type)\n    }\n\n    // 存在子节点\n    if (Array.isArray(children)) {\n        // 按位或运算，重设 shapeFlag 标识\n        vnode.shapeFlag = vnode.shapeFlag | ShapeFlags.ARRAY_CHILDREN\n    } else if (typeof children === 'string'){\n        vnode.shapeFlag = vnode.shapeFlag | ShapeFlags.TEXT_CHILDREN\n    }\n\n    return vnode\n}\n\n// 判断组件类型 (标签或组件)\nfunction getShapeFlag(type: any): any {\n    return typeof type === 'string'\n    ? ShapeFlags.ELEMENT\n    : ShapeFlags.STATEFUL_COMPONENT\n}","import { createVNode } from \"./createVNode\";\nexport const h = function (\n    type: any,\n    props: any,\n    children: string | Array<any>\n): any {\n    return createVNode(type, props, children);\n};\n","/**\n * @description: 创建组件实例\n * @param {any} vnode\n * @return {*}\n */\nexport const createComponentInstance = function (vnode: any) {\n    const instance = {\n        type: vnode.type,\n        vnode,\n        props: {},\n        proxy: null,\n    };\n    return instance;\n};\n","export function hostCreateElement(type: any) {\n    console.log('hostCreateElement', type);\n    const dom = document.createElement(type)\n    return dom\n}\n\nexport function hostSetElementText(el: HTMLElement, text) {\n    console.log('hostSetElementText', el, text);\n    el.innerText = text\n}\n\nexport function hostPatchProp(el, key, preValue, nextValue) {\n    console.log(`hostPatchProp 设置属性:${key} 的值:${nextValue}`);\n    switch(key) {\n        case \"tId\":\n            el.setAttribute(key, nextValue)\n            break;\n    }\n}\n\nexport function hostInsert(el, container) {\n    console.log(`hostInsert`);\n    container.append(el)\n}","import { ShapeFlags } from \"../shared\";\nimport { createComponentInstance } from \"./component\";\nimport {\n    hostCreateElement,\n    hostSetElementText,\n    hostPatchProp,\n    hostInsert,\n} from \"./render-api\";\nexport const render = function (vnode, container) {\n    console.log(\"调用 patch\");\n    patch(null, vnode, container);\n};\n\n/**\n * @description: 更新\n * @param {*} n1 旧节点\n * @param {*} n2 新节点\n * @param {*} container 容器\n * @return {*}\n */\nfunction patch(n1, n2, container) {\n    const { type, shapeFlag } = n2;\n    switch (type) {\n        case \"text\":\n            // 文字\n            break;\n        case \"comment\":\n            // 注释\n            break;\n        case \"static\":\n            break;\n        case \"fragment\":\n            break;\n        default:\n            // 其他类型基于 shapeFlag 处理，按位与\n            if (shapeFlag & ShapeFlags.ELEMENT) {\n                console.log(\"处理 element\");\n                processElement(n1, n2, container);\n            } else if (shapeFlag & ShapeFlags.STATEFUL_COMPONENT) {\n                console.log(\"处理 component\");\n                processComponent(n1, n2, container);\n            }\n    }\n}\n\n// 处理标签\nfunction processElement(n1, n2, container) {\n    // 旧节点不存在, 直接挂载\n    if (!n1) {\n        mountElement(n2, container)\n        // hostCreateElement(n2.type)\n    } else {\n\n    }\n}\n\n// 挂载标签\nfunction mountElement(vnode, container) {\n    const {shapeFlag, props} = vnode\n    // 根据 type 创建元素\n    const el = (vnode.el = hostCreateElement(vnode.type))\n    // 单子组件\n    if (shapeFlag & ShapeFlags.TEXT_CHILDREN) {\n        console.log(`处理文本:${vnode.children}`);\n        hostSetElementText(el, vnode.children)\n    } else if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n        // 多子组件\n        mountChildren(vnode.children, el)\n    }\n\n    // 处理属性\n    if (props) {\n        for (const key in props) {\n            const nextVal = props[key]\n            hostPatchProp(el, key, null, nextVal)\n        }\n    }\n\n    // beforeMount 钩子\n    console.log(\"vnodeHook -> onVnodeBeforeMount\");\n    console.log(\"DirectiveHook -> beforeMount\");\n    console.log(\"transition -> beforeEnter\");\n\n    // 将创建的 el 插入到 容器中\n    hostInsert(el, container)\n\n    // mount 钩子\n    console.log(\"vnodeHook -> onVnodeMount\");\n    console.log(\"DirectiveHook -> mount\");\n    console.log(\"transition -> enter\");\n}\n\n// 挂载子节点\nfunction mountChildren(children, container) {\n    children.forEach(c => {\n        console.log(\"mountChildren:\", c);\n        patch(null, c, container)\n    })\n}\n\n// 处理组件\nfunction processComponent(n1, n2, container) {\n    if (!n1) {\n        // 挂载组件\n        mountComponent(n2, container) \n    } else {\n\n    }\n}\n\n// 挂载组件\nfunction mountComponent(vnode, container) {\n    // 创建组件实例\n    const instance = (vnode.component = createComponentInstance(vnode))\n    console.log(`创建组件实例:${instance.type.name}`);\n    // 加工组件实例\n    setupComponent(instance)\n\n    setupRenderEffect(instance, container)\n}\n\n// 加工组件实例\nfunction setupComponent(instance) {\n    // 处理 props\n    initProps()\n    // 处理 slots\n    initSlots()\n\n    setupStatefulComponent(instance)\n}\n\nfunction initProps() {}\nfunction initSlots() {}\n\nfunction setupStatefulComponent(instance) {\n    // 1. 创建代理 proxy\n    console.log(`创建 proxy`);\n    // 2. 调用setup\n    const setupResult = instance.setup && instance.setup(instance.props)\n    // 3. 处理 setupResult\n    handleSetupResult(instance, setupResult)\n}\n\nfunction handleSetupResult(instance, setupResult) {\n    if (typeof setupResult === 'function') {\n        // 返回的渲染函数\n        // setup() {return () => h1('div')}\n        instance.render = setupResult\n    } else if (typeof setupResult === 'object') {\n        // 对象则先存到 setupState 上\n        instance.setupState = setupResult\n    }\n\n    finishComponentSetup(instance)\n}\n\nfunction finishComponentSetup(instance) {\n    // 给 instance 设置 render\n    // 获取用户设置的 component options\n    const component = instance.type\n    if (!instance.render) {\n\n    }\n    instance.render = component.render\n\n    // applyOptions()\n}   \n\nfunction applyOptions() {\n    // 兼容 vue2.x\n}\n\nfunction setupRenderEffect(instance, container) {\n    // 源码里面是直接调用了 reactivity\n  // 因为这次只处理初始化逻辑\n  // 所以暂时用不到\n  // 后面这里是作为 update 的主要逻辑\n\n  // 调用 render\n  // 应该传入 ctx 也就是 proxy\n  // ctx 可以选择暴露给用户的 api\n  // 源代码里面是调用的 renderComponentRoot 函数\n  // 这里为了简化直接调用 render\n  console.log(\"调用 render,获取 subTree\");\n  const subTree = instance.render(instance.proxy);\n  console.log(\"subTree\", subTree);\n\n  // todo\n  console.log(`${instance.type.name}:触发 beforeMount hook`);\n  console.log(`${instance.type.name}:触发 onVnodeBeforeMount hook`);\n\n  // 这里基于 subTree 再次调用 patch\n  // 基于 render 返回的 vnode ，再次进行渲染\n  // 这里我把这个行为隐喻成开箱\n  // 一个组件就是一个箱子\n  // 里面有可能是 element （也就是可以直接渲染的）\n  // 也有可能还是 component\n  // 这里就是递归的开箱\n  // 而 subTree 就是当前的这个箱子（组件）装的东西\n  // 箱子（组件）只是个概念，它实际是不需要渲染的\n  // 要渲染的是箱子里面的 subTree\n  patch(null, subTree, container);\n\n  console.log(`${instance.type.name}:触发 mounted hook`);\n}\n","import { render } from \"./renderer\";\nimport { createVNode } from \"./createVNode\";\nexport const createApp = function (rootComponent: any, rootProps: object) {\n    const app = {\n        _component: rootComponent,\n        _container: null,\n        mount,\n    };\n\n    // 挂载\n    function mount(rootContainer: any) {\n        console.log(\"基于根组件创建 vnode\");\n        const vnode = createVNode(rootComponent, rootProps, '');\n        app._container = rootContainer;\n        console.log(\"调用 render，基于 vnode 进行开箱\");\n        render(vnode, rootContainer);\n    }\n\n    return app;\n};\n"],"names":[],"mappings":"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"}